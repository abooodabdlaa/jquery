<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr" id="html">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Effects: matching timestamps</title>
	<style>
		#test-div {
			width: 200px;
			height: 1000px;
			background-color: green;
		}
	</style>
</head>
<body>
	<script src="../../jquery.js"></script>
	<script src="../iframeTest.js"></script>
	<div id="test-div"></div>
	<script>
		//<![CDATA[
		setTimeout( function () {

			// Handle a timeout.
//		    startIframeTest( false, "The test timed out" );
		}, 5000 );

		var maxNow = 0;
		var maxCounter = 0;
		var maxPerfNow = 0;

		jQuery( "#test-div" ).animate( {
			height: '2000px',
		}, {
			duration: 300,
			step: function( now ) {
				if ( maxNow > now ) {
					console.error( "Animation is stepping back from " + maxNow + " to " + now,
						maxCounter, window.counter, maxPerfNow, window.performance.now() );
					console.trace();
				}
				if ( maxNow - now > 100 ) {
					startIframeTest( false, "Animation is stepping back from " + maxNow + " to " + now );
				}
				if ( now > maxNow ) {
					maxNow = now;
					maxCounter = window.counter;
					maxPerfNow = window.performance.now();
				}
			},
			complete: function() {
//				startIframeTest( true );
			}
		} );
		//]]>
	</script>
</body>
</html>
